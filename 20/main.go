package main

import (
	"fmt"

	"github.com/Laxen/gohelpers/math"
)

func windowContents(image []string, void string, xcenter, ycenter int) string {
	ret := ""
	for y := ycenter - 1; y <= ycenter+1; y++ {
		for x := xcenter - 1; x <= xcenter+1; x++ {
			if x < 0 || y < 0 || x > len(image[0])-1 || y > len(image)-1 {
				ret += void
				continue
			}
			if image[y][x] == '.' {
				ret += "0"
			} else {
				ret += "1"
			}
		}
	}
	return ret
}

func binToDec(bin string) (ret int) {
	for i, c := range bin {
		if c == '1' {
			ret += math.Pow(2, len(bin)-i-1)
		}
	}
	return ret
}

func computeNewImage(image []string, void string, enhancement string) ([]string, string) {
	newImage := make([]string, len(image)+2)

	for y := -1; y <= len(image); y++ {
		row := ""
		for x := -1; x <= len(image[0]); x++ {
			contents := windowContents(image, void, x, y)
			dec := binToDec(contents)
			pixel := enhancement[dec]
			row += string(pixel)
		}
		newImage[y+1] = row
	}

	// void is either all 0s (0b0) or all 1s (0b111111111 = 511)
	if void == "0" {
		if enhancement[0] == '#' {
			void = "1"
		} else {
			void = "0"
		}
	} else {
		if enhancement[511] == '#' {
			void = "1"
		} else {
			void = "0"
		}
	}
	return newImage, void
}

func printImage(image []string) {
	for _, row := range image {
		fmt.Println(row)
	}
}

func main() {
	// enhancement := "..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..###..######.###...####..#..#####..##..#.#####...##.#.#..#.##..#.#......#.###.######.###.####...#.##.##..#..#..#####.....#.#....###..#.##......#.....#..#..#..##..#...##.######.####.####.#.#...#.......#..#.#.#...####.##.#......#..#...##.#.##..#...##.#.##..###.#......#.#.......#.#.#.####.###.##...#.....####.#..#..#.##.#....##..#.####....##...##..#...#......#.#.......#.......##..####..#...#.#.#...##..#.#..###..#####........#..####......#..#"
	// input := []string{
	// 	"#..#.",
	// 	"#....",
	// 	"##..#",
	// 	"..#..",
	// 	"..###",
	// }

	enhancement := "####....#.....##.####..#.##.###.########.##.#..#.##.#...#..##.######..#......#..###.#.##.####.#.#.#....######.###...###.#.###.####..###.......#..#.#.#.#.#.####..####.#..####.#..####..##.#.#.#.###..##..#....#...###.#....###....##.###...##..#..#..#...##...#.#..#..###...####.#.#.###..#.#.#..###.##.##.#..###...#.#.#.##...#...#..#...##..###..###..#...###.#....#.##.#.####...##...##.#.####.#####.##...#######.###..##.#####.##.....####.#######.#.#.##....#...##...#..##.###.######.#######.#.#.#....#..##.###.#..##..##."
	input := []string{
		"###..#..........#.#.###.###.#.#..###.#.###.###.#....#.#.....###.#...#####.####...####.#..####....##.",
		"#..####.##.##..###..#.#...#.######.#.#.#.......######......#...###.####...#..#..#.#.###.#.##.#..#..#",
		"#..#####.....###....#..##..#...##...#.####..##...#..##.#.#...#.#.......#...#.#....##.##.#..#..#.###.",
		".#.#..#..##.##.#.##..##....###...#..#.#.#..##..#.####...#..##...###.#.#.#..#.#..##..##.#.##......###",
		"##.#.###...#.#.#.#..#.....##.....##.#.#.#.###..#.#...####..###.##...#..#.##....##....#...#..#.###..#",
		"###..#.#.#.....#....#.##.####..###.#####..#..########.##.#.#..#...#####..####.#...#..###..###...#..#",
		"#.#.##..###..##.##.#.#..###.##...#..#..#..#...#..#.#.###...#..##.##.##..###.#.#.#..#....#....####.#.",
		"#.###.#..##..#.###.#####.#..#.###..##...#..#.#.###...##.#...###...#...#...##..#...##.#..##.##.###...",
		".#.###..#.#.#.####.#.##...#....#....#.#.##....##.#####.#....#....#####..#.#......###....###..##....#",
		".##.......#...#.#.#....#....#..#..#.###.#.#.##########.##..#####..#.#.##...#..#.###.#...#.#....#####",
		"..#..#.###.#.#.####..###.####.#.###.#..#..#.#...#..#.#..####.#.#####.#..#...##.#.#.###.##.####......",
		".##..#..#####...#..#.#..#.......#.#.#.#..####.##..#..##.##...#...######..####...#....#....##.#.#.##.",
		"...#.##.#..##..#.##.##.##.#.#.....#.....#..#.#.#..#...####.#####.##.###.#..####..####..#.##....###.#",
		".##.##......##.#..#....#######..##.####.#...######....######.##.#.##..#..#.#..##..##.#.#####.#.....#",
		"###..#####.#..#...#.##...###...##.#.##..##.##.####.###..#.##.#.##.###....#..#.##.###..##.##.##..##.#",
		".#.#.##.#.......#.#..#...#.######..#..##.##.##.###.##.###.#.#.#...#..##.##.###..#..#..#..##..#.#.#..",
		"##..###..#...##.#....##....#...##.#.#####.#..#.###.#..#..#####.##.#######.####.##.#..##.##..#.####.#",
		".#..###.##...#.#.###.#.#.##.##.#.#...#..#.###..#.#.#####..#..###...#.#..#.###......###.#.#...##.##.#",
		"...#.#..#...###...#..#####.##..####..###.###.#....#....#...#.###.#..##.#.#.##...#.###..###..##.##.#.",
		"##..#.#.###.#####...#####..#.###..##.#.#.#...##.#####.####.....#.###...##.####.#...#....#..#..###.##",
		"#.....#.#.##.###...#..######.#.#.#######.#..#.##.#.#...#..###.###.#..........####..#..#...#######...",
		".##..##.#..#.#...##.###.....##.#..#...#..##.#.....#.#.#.##.###.#######..###.....#.###..#....##.#.#..",
		".##.#.##.....#...#...#.#.#..#......##.#.##.#..#....#....#####.######..#......####...#.###.##.##..##.",
		".#.####....###...#..##.#####.#....##.#.##..#.#.#.#.##.#.#......###.#..###.###.....#.#.###...#.##.#..",
		"..#.....##...##...#.#..##...#.....#..#.#.####.#......#.###...#.#.#..##.##.##.##.#....##..###.#.#.#.#",
		"#.###..#...#..#.#.....##.####.#......#####...#####.##.#######..####.......##.###....#.###....##..#..",
		"##.#.#..........#....###...##.###.##.#.#....##..#....#.##.##..####...##...##.##..#.#.#######..###.##",
		".###.##.#..###############.#.#..#..##..#.#####.##.#..##.#......#.##...####.......#####..########.#.#",
		"......#..#..#.#####.#..#.#.##.##..###.###..####.##...#.#.....####..#..#..#..##...#.#..#.###.#..##...",
		"#....###...##.###..###..#.##.....#.#....##..###..###.##..##..#.##..###.##.##.#..#.....##.#.#.##.....",
		".#.###.###..#.##..#...##..##..##....#..#..#..####.##..##..##....#.##..#.#...#....###.##..#.#..#.#.##",
		".#.#.###.#..###.#..#.#.#.##..#.#...#####.#.#.########.###...####.##.....#...#..#..####..#.########..",
		"..##.##.#.##.##.##..##.#..#.##.##.##.########.####...##.#.##.#####...###..#....##....##..#..####...#",
		"..##.###.......##......##.#####.####.###.#.#.#.#.#.#.##.###.#...#.#..##..#....#......#.#..#....#.#..",
		"######..#..######..##.##.#..#..##...#.#.##.##.#.####.##..##..#.###.#...##..#..#.#........##.##.##...",
		".#..##...#.#..##.#.....######..#.#######..#.#..#.##.##.#.####.#..##.#..#...#..##...#.#.###.######.##",
		"......#....##.####....#.####..#..#...####...#.##..##....##....##.#.#.##.########..#....#.###.#...#.#",
		".......#.....#.#.##..#....##.###.#..##.#.#...#..#......#.#..#......#...#....#..#.##....###.##.###...",
		"#..#.##.#...#.##..######..#.##...###..#...#..####.#......#..#.#..##.#.####.#...##.#...#.#.#..##.#.#.",
		"#...##.#...#.##..#.##..#..#.#.#..#.##...######..#..#..#..#..#...###..##.###.#.#...#..####.####...#.#",
		"####.#....###.#..##.#.#..#...#..##.##.##...##.#########..#.......#######...#.#.####.#...#...##....##",
		".##..#.#..#.#.#..#.###.##.##.#.#.#####.......#####.......#.#.##.##..##......#.#####..###......#..###",
		"...##..#.#.##..#######.#..#..#.....#..#.########..###.###.#.##.#..###...#..#....##.#.#####.##.##.#.#",
		"##....#...#.###.#...#....###.#.#...###.....##.##.#...#.##..##.##.##.##....##.##.##.##.####.......#.#",
		"##.####.###..####..#...###..####.##.##.#######.#..####.##.######.#...#.####.##.##.#....#.##..#.#.##.",
		"..##..######.#.#.##..#..#####..#.#..#......###..######.##....#........#.##.#.##.##.#.....###...#.#.#",
		"#.#...#..##.#..##.#.#..#..######.#....#..##.#....###..##.#.#.#.#.#..###.###.###..##...#.......##.#.#",
		"#.#.#.#####.##...####.##.##.##...#..##.##.##.###.#...##...#.##..##..#.#...##..#....##..#......#####.",
		"##.##.....#.#.#...####.#...#####.##...#.....#..#..#.#.#.#..#....#.#.##....##.##....##.##.#.#......##",
		"#.#.##..#.#..#.....#..#.#..###.#..#####....####..######..#..##.#.#.#..##..####.....#######...#.#.##.",
		"##...###.....##...#.#.##.####..#...###.#..######.....######....##..####..#####..##.###......#..##..#",
		"##.#.###.#.##.####.###.##..##........#..#####.....#.###.#.#....##.#.###.#...#.#..#.........##.#.##..",
		"....#.####...#.#........###..#.###.###..####..####...#.##...###########.#.##.###..#..####.#..#.##.##",
		".#####....##.#.#..#..#.##...##......##.#.#....######.......###.#.#.##.#.....#...#.#.....#.###...###.",
		"##..#..####..###.###...#...#.##.#.#..##.#.##.##.##....#.#.#...#...#..#.#.###....#..##.......##.#.#..",
		"##.#.#.##.#.#.######..###..#..####.........##.#..##########.###..#.#..#...##.##...#####.....#.#..#.#",
		"##.#..#..#.#.##...######.#...##..###..##..##.#..####..#..##.#....##.#........#####.###...###.##...#.",
		"....#.#.##...##...##..####.#####.#.#####.#..#.########....##.....###.#.##.#..####.##.#.....###.#.#..",
		"#####.#.#.###.#####.##...###.####..##.##..##.##.##.#.###.####..##...#.##.#..##...######...#.....##.#",
		"#..##.#.###.###....#..###..........#.##.#..#.#.####..#.####..###......##.....#.###....###.#.....#.##",
		".######...#####.###..##.#......###...###..#.#.#.###..#.###.....#.#...##..#..##.##.##..#......#.####.",
		"#..##..#...##.##...###......#..#.###..###..##....##...##.##.#...####.####..##...##.#..#....##.#.#.#.",
		"#.##..##.......#.#.##.##.#....###....#.###.##.#....#.#..####....###.##.#.##...#..#.##...#......#.#..",
		"..#..#...#.....#.##.#.####......#....#.##...###.#...##.#..#..#......#...##.###.###..#.##.####...#...",
		"#..##.##.#.##..####.#.##...#.#.#.#.##.#.##....#.#.#...#.####...####.#.##......###..#..##.##...#..#.#",
		"...#..#.#.#...#....####.#.##....###.#..#.####.##..#.##.##...#.#.##.#.#.....#.....###.###..###.#####.",
		"..#.####.....#..##.##..#...##..#...##....#.#####.#..#...#..#..#..#####.#.##.#.....#.###..###..#...##",
		"#.##...#.##...#..#.......#.....###...##.#..#.......#...#.#..####...#...#..##....####..#..###.#..#...",
		"......##...#..#..####..##.#.#...#.#...###....###.##..#.#.##.#.##.##.#.#.#####.##.####.###.#.#.###...",
		"#.#.#.#..#...#...#....##.######....###.#..#..#.#..##..##.###...#..#.##...###..####...###...##.######",
		".####..###.#.#...#.#.#.#..###....##.###.##.....#.#.####...#.##..###.#.####.##.###..###.##..#.....#.#",
		".......#..##.##.######..#.####.#...##.##..##.##.##.#.##.##.#.#...##.#.#..#..#.#..#.#.##.###.###.#...",
		".#.......#..#.#..#.#..##...##..#.....#.#.##.##...#.#######.#.##.#..#....#.##...#####..###.#.#.#.##..",
		"##.##..#.###...##......#..#.#.#..#...#.#.#...##.###..#.#####..###.##....#..###.......##.#...#..#.###",
		"#.####..#....#...###.#.##.##..#..#..###...#..#.####.##....#.#..#..#.##.##..###.##.##..##.#.#.##.###.",
		"###.#...###...##...##.#..#..#####.#....##.#..##...###..#..##.#.####.##.#..###.##..#.#..##....#..##..",
		"#.####.####.##.#.....###..#.##..##..#....#......##...#...#.###..##.###..#......####.##.#..#.#.##.#..",
		".......###.#.#.....####.#..####.......##......#.#.#....#####...##..###.....#.#..###..#.####.##.#.###",
		"#..#..#...#..#####..###..#..##.#.#...####..#.#......#.#...##.##..#.##.####..#####.####..#.#..####.##",
		"#..######..#......#..####..##....###.#.##.#.#.#####.#.##.#..##..#.##.####.#.##.#.#.###..###.###...##",
		"...#.#.####.##..##....####..#......###..##...##.#...#.#...#..#.#..##....###.##.#..#####.##..###.#.##",
		"..#####.##..####..#...#...#.###..#..##.#..#.#....#.####.##...#.#####..#.##..#.#######.#..#.##......#",
		"##....##.#.#.#.##...######..##..#.#.##....##.#...###.#..######.#.##..######.##..#...#..#..###..#.##.",
		".###...###..#####.#......####.......####..#.....##..#.##..#..#####..##.#...#.#...#.###..###....#####",
		".###.#...#.##.#.##.#.....#..#..#.#####.....####.##..####..#...#.###.#..#.##.#...####..#....#.##...#.",
		"#...##..##.#.##.###.##..#..#.....#..#.###.####.#...#.##.##....#.#.#####.######.#...###.##.#.#.#.#.#.",
		"#.#####...#.#.#####..#.#..#...######...##.##.###.#....#..###.........#.##...#.##...#.##...####....#.",
		".###.#####..##.##..#.###.....######.######....##..##.#.##.#####..###..###...##.#..##.#..#..........#",
		"....#.#.#.##...#####..###...#..#.####.##..####...####..........#....#.#.#..#...####.##.........#####",
		"####.##..##...#.#.###..#####.....##.#....#.#...#.#####.#####...#.##.##..###.......##.##..##..####.#.",
		"#..#####...##....#.#.#######.#..##..##..##.#..######.###.#.###..##.####.##..#.#.##.##..#.##.#.###.##",
		"#####...#...#.##.##..##.###.##.###..####...##..##..#.#.#.#.#.####.#.#..#.###...#.#........#..###.#..",
		".###.#..#.##.#.####.#....###..#.#.##.#.....#..#.###..####..###..#.##.#.##.##.....###..#.##...#..#...",
		".#.#....#.###.#.#...#.#.##..#..#....#####.....###.###..#.####..###.###.#####...#..#.###.#..##.#..##.",
		".##...#.#....###...###.#.#.##.##.#..###.#.#...#.###.#.#...##..###.##.......#....#..#..#...#..#...###",
		".###.###.###.##.#.#.#...#.#..#..#.#.#.#.#.#.##.###.##.##..##..#...#.#.####..#.##..##......#...#.#.##",
		"#####.#........#...#####..#.#.####..##.##..##..####.#......##.#.....#..#.###.#..######.#..#.#..#..#.",
		"#...#..####...###.#####..#.#.#..####....#.##..##..#..#.#..###.....#...#.#....##.###.....#...###.###.",
		"...#......#...#.###.#...#....##.....##...###.###.#....##.##.#...##.####.#.##.###.##.###..#.#.###.##.",
		"#####...###.##.##.#..###.#...#..#..#..#...#####.#####..#..#......#.#.######.##.#########..##.###..#.",
	}

	image := input
	void := "0"
	for i := 0; i < 50; i++ {
		image, void = computeNewImage(image, void, enhancement)
	}

	sum := 0
	for _, row := range image {
		for _, c := range row {
			if c == '#' {
				sum++
			}
		}
	}
	fmt.Println(len(image))
	fmt.Println(len(image[0]))
	fmt.Println(sum)

	// 5860 too high
	// 5842 too high
}
